!function(e){function t(t){for(var n,c,a=t[0],u=t[1],s=t[2],l=0,d=[];l<a.length;l++)c=a[l],o[c]&&d.push(o[c][0]),o[c]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(e[n]=u[n]);for(f&&f(t);d.length;)d.shift()();return i.push.apply(i,s||[]),r()}function r(){for(var e,t=0;t<i.length;t++){for(var r=i[t],n=!0,a=1;a<r.length;a++){var u=r[a];0!==o[u]&&(n=!1)}n&&(i.splice(t--,1),e=c(c.s=r[0]))}return e}var n={},o={2:0},i=[];function c(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,c),r.l=!0,r.exports}c.m=e,c.c=n,c.d=function(e,t,r){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},c.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(c.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)c.d(r,n,function(t){return e[t]}.bind(null,n));return r},c.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/";var a=window.webpackJsonp=window.webpackJsonp||[],u=a.push.bind(a);a.push=t,a=a.slice();for(var s=0;s<a.length;s++)t(a[s]);var f=u;i.push([136,0]),r()}({11:function(e,t,r){"use strict";r.d(t,"c",function(){return f}),r.d(t,"e",function(){return h}),r.d(t,"d",function(){return m}),r.d(t,"b",function(){return v}),r.d(t,"a",function(){return b});var n=r(87),o=r.n(n),i=r(9),c=r.n(i),a=r(22),u="==UserScript==",s="==/UserScript==";function f(e){return!/^\s*</.test(e)&&!(e.indexOf(u)<0)}var l={default:function(){return[]},transform:function(e,t){return e.push(t),e}},d={default:function(){return null},transform:function(e,t){return null==e?t:e}},p={include:l,exclude:l,match:l,excludeMatch:l,require:l,resource:{default:function(){return{}},transform:function(e,t){var r=t.match(/^(\w\S*)\s+(.*)/);return r&&(e[r[1]]=r[2]),e}},grant:l,noframes:{default:function(){return!1},transform:function(){return!0}}};function h(e){var t=Object.keys(p).reduce(function(e,t){return Object.assign(e,{[t]:p[t].default()})},{}),r=-1;return e.replace(/(?:^|\n)\s*\/\/\s*([@=]\S+)(.*)/g,function(e,n,o){if(r<0&&n===u?r=1:r>0&&n===s&&(r=0),1===r&&"@"===n[0]){var i=n.slice(1).split(":"),a=c()(i,2),f=a[0],l=a[1],h=f.replace(/[-_](\w)/g,function(e,t){return t.toUpperCase()}),m=l?`${h}:${l.toLowerCase()}`:h,v=o.trim(),b=p[m]||d,g=t[m];void 0===g&&(g=b.default()),t[m]=b.transform(g,v)}}),t.resources=t.resource,delete t.resource,!t.homepageURL&&t.homepage&&(t.homepageURL=t.homepage),t}function m(e){var t=o()({url:"*://*/*"},e),r=Object(a.c)("scriptTemplate").replace(/{{(\w+)}}/g,function(e,r){var n=t[r];return null==n?e:n});return{script:{custom:{origInclude:!0,origExclude:!0,origMatch:!0,origExcludeMatch:!0},config:{enabled:1,shouldUpdate:1},meta:h(r)},code:r}}function v(e){var t=e.meta.namespace||"",r=e.meta.name||"",n=`${escape(t)}:${escape(r)}:`;return t||r||(n+=e.props.id||""),n}function b(e,t){for(var r=(e||"").split("."),n=(t||"").split("."),o=0;o<r.length||o<n.length;o+=1){var i=(parseInt(r[o],10)||0)-(parseInt(n[o],10)||0);if(i)return i<0?-1:1}return 0}},13:function(e,t,r){"use strict";r.d(t,"a",function(){return o}),r.d(t,"b",function(){return i});var n=r(0);function o(e){browser.notifications.create(e.id||"ViolentMonkey",{type:"basic",iconUrl:n.d,title:`${e.title} - ${Object(n.i)("extName")}`,message:e.body,isClickable:e.isClickable})}function i(){var e;return(e=browser.runtime).sendMessage.apply(e,arguments).catch(n.m)}},136:function(e,t,r){"use strict";r.r(t),function(e){var t,n=r(9),o=r.n(n),i=r(0),c=r(1),a=r(20),u=r(3),s=r(72),f=r(91),l=r(5),d=r(33),p=r(35),h=browser.runtime.getManifest().version,m=["setIcon","setBadgeText","setBadgeBackgroundColor"].reduce(function(e,t){var r=browser.browserAction[t];return e[t]=r?r.bind(browser.browserAction):i.m,e},{});function v(){Object(u.t)("lastUpdate",Date.now()),Object(l.i)().then(function(e){var t=e.filter(function(e){return Object(c.a)(e,"config.shouldUpdate")});return Promise.all(t.map(u.c))}).then(function(e){e.some(Boolean)&&a.e()})}function b(){t||(t=!0,function e(){new Promise(function(e,t){if(!Object(u.i)("autoUpdate"))return t();Date.now()-Object(u.i)("lastUpdate")>=864e5&&e(v())}).then(function(){return setTimeout(e,36e5)},function(){t=!1})}())}Object(u.k)(function(e){"isApplied"in e&&y(e.isApplied),"autoUpdate"in e&&b(),"showBadge"in e&&browser.tabs.query({}).then(function(e){e.forEach(function(e){O(e.id)})});"scriptTemplate"in e&&!e.scriptTemplate&&Object(u.t)("scriptTemplate",Object(u.g)("scriptTemplate")),Object(u.r)({cmd:"UpdateOptions",data:e})});var g={NewScript:e=>e&&u.b.get(`new-${e}`)||Object(u.o)(),CacheNewScript(e){var t=Object(i.h)();return u.b.put(`new-${t}`,Object(u.o)(e)),t},RemoveScript:e=>Object(l.n)(e).then(function(){a.e()}),GetData:e=>(e?Object(l.a)():Promise.resolve()).then(l.d).then(function(e){return e.sync=a.b(),e.version=h,e}),GetInjected(e,t){var r=e.url,n=e.reset,o=t.tab||{};n&&o.id&&Object(p.b)(o.id);var i={isApplied:Object(u.i)("isApplied"),version:h};return i.isApplied?Object(l.j)(r).then(function(e){return Object(p.a)(o.id,Object.keys(e.values)),Object.assign(i,e)}):i},UpdateScriptInfo(e){var t=e.id,r=e.config;return Object(l.p)(t,{config:r,props:{lastModified:Date.now()}}).then(function(e){var t=o()(e,1)[0];a.e(),Object(u.r)({cmd:"UpdateScript",data:{where:{id:t.props.id},update:t}})})},GetValueStore:e=>Object(l.k)([e]).then(function(t){return t[e]||{}}),SetValueStore(e){var t=e.where,r=e.valueStore;return Object(p.c)(t,r)},UpdateValue(e){var t=e.id,r=e.update;return Object(p.d)(t,r)},ExportZip(e){var t=e.ids,r=e.values;return Object(l.e)(t,r)},GetScriptCode:e=>Object(l.h)(e),GetMetas:e=>Object(l.g)(e),Move(e){var t=e.id,r=e.offset;return Object(l.l)(t,r).then(function(){a.e()})},Vacuum:l.q,ParseScript:e=>Object(l.m)(e).then(function(e){return a.e(),e.data}),CheckUpdate(e){Object(l.f)({id:e}).then(u.c).then(function(e){e&&a.e()})},CheckUpdateAll:v,ParseMeta:e=>Object(u.q)(e),GetRequestId:u.j,HttpRequest(e,t){Object(u.l)(e,function(e){browser.tabs.sendMessage(t.tab.id,{cmd:"HttpRequested",data:e}).catch(i.m)})},AbortRequest:u.a,SetBadge:function(e,t){var r=e.ids,n=e.reset,o=t.tab||{},i=!n&&j[o.id];i||(i={number:0,unique:0,idMap:{}},j[o.id]=i);i.number+=r.length,r&&(r.forEach(function(e){i.idMap[e]=1}),i.unique=Object.keys(i.idMap).length);m.setBadgeBackgroundColor({color:"#808",tabId:o.id}),O(o.id)},SyncAuthorize:a.a,SyncRevoke:a.d,SyncStart:a.e,CacheLoad:e=>u.b.get(e)||null,CacheHit(e){u.b.hit(e.key,e.lifetime)},Notification:f.a,SetClipboard:u.s,TabOpen:s.b,TabClose:s.a,GetAllOptions:u.f,GetOptions:e=>e.reduce(function(e,t){return e[t]=Object(u.i)(t),e},{}),SetOptions(e){(Array.isArray(e)?e:[e]).forEach(function(e){Object(u.t)(e.key,e.value)})},ConfirmInstall:u.d,CheckScript(e){var t=e.name,r=e.namespace;return Object(l.f)({meta:{name:t,namespace:r}}).then(function(e){return e?e.meta.version:null})},CheckPosition:()=>Object(l.o)()};Object(u.m)().then(function(){browser.runtime.onMessage.addListener(function(t,r){var n,o=g[t.cmd];return o&&void 0!==(n=o(t.data,r))&&(n=Promise.resolve(n).then(function(e){return{data:e}},function(t){return e.env.DEBUG&&console.error(t),{error:t}})),n||null}),setTimeout(b,2e4),a.c(),Object(d.a)(),Object(l.a)()});var j={};function O(e){var t=j[e];if(t){var r,n=Object(u.i)("showBadge");"total"===n?r=t.number:n&&(r=t.unique),m.setBadgeText({text:`${r||""}`,tabId:e})}}function y(e){m.setIcon({path:{19:`/public/images/icon19${e?"":"w"}.png`,38:`/public/images/icon38${e?"":"w"}.png`}})}browser.tabs.onRemoved.addListener(function(e){delete j[e]}),y(Object(u.i)("isApplied"))}.call(this,r(15))},140:function(e,t){e.exports=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},18:function(e,t,r){"use strict";var n=r(52);t.a=Object(n.a)({lifetime:1e4})},20:function(e,t,r){"use strict";var n,o=r(14),i=r.n(o),c=r(9),a=r.n(c),u=r(0),s=r(1),f=r(3),l=r(5),d={update:e=>Object(l.m)(e),list:()=>Object(l.i)(),get:e=>Object(l.h)(e),remove:e=>Object(l.n)(e)},p=[],h=[],m={},v=Object(u.c)(_,36e5),b=Promise.resolve();function g(e){var t=e.name,r=e.uri;return r?function(e){return`vm-${encodeURIComponent(e)}`}(r):t}function j(e){return/^vm-/.test(e)}function O(e){return decodeURIComponent(e.slice(3))}function y(e,t,r){var n=t||e[0];function o(){return n}return{get:o,set:function(t){return e.includes(t)?(n=t,r&&r()):console.warn("Invalid state:",t),o()},is:function(e){return(Array.isArray(e)?e:[e]).includes(n)}}}function w(){return p.map(function(e){var t=m[e];return{name:t.name,displayName:t.displayName,authState:t.authState.get(),syncState:t.syncState.get(),lastSync:t.config.get("meta",{}).lastSync,progress:t.progress}})}function k(e){var t=function(){this.initialize()};return t.prototype=e,t.extend=S,t}function S(e){return k(Object.assign(Object.create(this.prototype),e))}var x=Object(u.c)(function(){Object(f.r)({cmd:"UpdateSync",data:w()})}),E=k({name:"base",displayName:"BaseService",delayTime:1e3,urlPrefix:"",metaFile:"Violentmonkey",initialize(){var e=this;this.progress={finished:0,total:0},this.config=function(e){function t(t){var r=Object(u.n)(t);return r.unshift("services",e),r}return{get:function(e,r){return n.get(t(e),r)},set:function(e,r){if("object"==typeof e){var o=e;Object.keys(o).forEach(function(e){n.set(t(e),o[e])})}else n.set(t(e),r)},clear:function(){n.set(t(),{})}}}(this.name),this.authState=y(["idle","initializing","authorizing","authorized","unauthorized","error"],null,x),this.syncState=y(["idle","ready","syncing","error"],null,x),this.lastFetch=Promise.resolve(),this.startSync=this.syncFactory();var t=Object(f.h)();["on","off","fire"].forEach(function(r){e[r]=function(){t[r].apply(t,arguments)}})},log(){var e;(e=console).log.apply(e,arguments)},syncFactory(){var e,t,r=this,n=function(){return r.authState.is("authorized")&&P()===r.name},o=function(){if(!n())return Promise.resolve();r.log("Ready to sync:",r.displayName),r.syncState.set("ready"),b=b.then(function(){return new Promise(function(e){(t=Object(u.c)(e,1e4))()})}).then(function(){if(n())return r.sync();r.syncState.set("idle")}).catch(function(e){console.error(e)}).then(function(){e=null,t=null}),e=b};return function(){return e||o(),t&&t(),e}},prepareHeaders(){this.headers={}},prepare(){var e=this;return this.authState.set("initializing"),(this.initToken()?Promise.resolve(this.user()):Promise.reject({type:"unauthorized"})).then(function(){e.authState.set("authorized")},function(t){throw t&&"unauthorized"===t.type?e.authState.set("unauthorized"):(console.error(t),e.authState.set("error")),e.syncState.set("idle"),t})},checkSync(){var e=this;return this.prepare().then(function(){return e.startSync()})},user:u.m,handleMetaError(e){throw e},getMeta(){var e=this;return this.get({name:this.metaFile}).then(function(e){return JSON.parse(e)}).catch(function(t){return e.handleMetaError(t)})},initToken(){this.prepareHeaders();var e=this.config.get("token");return this.headers.Authorization=e?`Bearer ${e}`:null,!!e},loadData(e){var t=this,r=this.progress,n=e.delay;null==n&&(n=this.delayTime);var o=Promise.resolve();return n&&(o=this.lastFetch.then(function(e){return new Promise(function(t){var r=n-(Date.now()-e);r>0?setTimeout(t,r):t()})}).then(function(){return Date.now()}),this.lastFetch=o),r.total+=1,x(),o.then(function(){var r=e.prefix;null==r&&(r=t.urlPrefix);var n=Object.assign({},t.headers,e.headers),o=e.url;return o.startsWith("/")&&(o=r+o),Object(u.o)(o,{headers:n,method:e.method,body:e.body,responseType:e.responseType})}).then(function(e){return{data:e.data}},function(e){return{error:e}}).then(function(e){var t=e.data,n=e.error;return r.finished+=1,x(),n?Promise.reject(n):t})},getLocalData:()=>d.list(),getSyncData(){var e=this;return this.getMeta().then(function(t){return Promise.all([{name:e.metaFile,data:t},e.list(),e.getLocalData()])})},sync(){var e=this;return this.progress={finished:0,total:0},this.syncState.set("syncing"),this.prepare().then(function(){return e.getSyncData()}).then(function(t){var r=a()(t,3),n=r[0],o=r[1],c=r[2],p=n.data,h=p.info||{},m=p.timestamp||0,v=!m||Object.keys(h).length!==o.length,b=Date.now(),g=Object(f.i)("lastModified"),j={},O=e.config.get("meta",{}),y=!O.timestamp,w=y||m>O.timestamp;e.log("First sync:",y),e.log("Outdated:",w,"(","local:",O.timestamp,"remote:",m,")");var k=[],S=[],x=[],E=[],U=[];p.info=o.reduce(function(e,t){j[t.uri]=t;var r=h[t.uri];return r||(r={},v=!0),e[t.uri]=r,r.modified||(r.modified=b,v=!0),e},{}),c.forEach(function(e){var t=e.props,r=t.uri,n=t.position,o=t.lastModified,i=p.info[r];if(i){var c=j[r];y||!o||i.modified>o?k.push({local:e,remote:c,info:i}):(i.modified<o&&(S.push({local:e,remote:c}),i.modified=o,v=!0),i.position!==n&&(i.position&&g<=m?U.push({local:e,remote:c,info:i}):(i.position=n,v=!0))),delete j[r]}else y||!w||o>m?S.push({local:e}):E.push({local:e})}),Object.keys(j).forEach(function(e){var t=j[e],r=p.info[e];w?k.push({remote:t,info:r}):x.push({remote:t})});var P=i()(k.map(function(t){var r=t.remote,n=t.info;return e.log("Download script:",r.uri),e.get(r).then(function(e){var t=function(e){var t={};try{var r=JSON.parse(e);t.code=r.code,2===r.version?(t.config=r.config,t.custom=r.custom,t.props=r.props):1===r.version&&r.more&&(t.custom=r.more.custom,t.config=Object(s.c)({enabled:r.more.enabled,shouldUpdate:r.more.update}),t.props=Object(s.c)({lastUpdated:r.more.lastUpdated}))}catch(r){t.code=e}return t}(e);if(t.code){n.modified&&Object(s.d)(t,"props.lastModified",n.modified);var r=+n.position;return r&&(t.position=r),!Object(f.i)("syncScriptStatus")&&t.config&&delete t.config.enabled,d.update(t)}})})).concat(i()(S.map(function(t){var r=t.local,n=t.remote;return e.log("Upload script:",r.props.uri),d.get(r.props.id).then(function(t){var o=function(e,t,r){var n;return 2===t?n={version:t,custom:e.custom,config:e.config,props:Object(s.b)(e.props,["lastUpdated"])}:1===t&&(n={version:t,more:{custom:e.custom,enabled:e.config.enabled,update:e.config.shouldUpdate,lastUpdated:e.props.lastUpdated}}),Object.assign(n,r)}(r,1,{code:t});return p.info[r.props.uri]={modified:r.props.lastModified,position:r.props.position},v=!0,e.put(Object.assign({},n,{uri:r.props.uri}),JSON.stringify(o))})})),i()(x.map(function(t){var r=t.remote;return e.log("Remove remote script:",r.uri),delete p.info[r.uri],v=!0,e.remove(r)})),i()(E.map(function(t){var r=t.local;return e.log("Remove local script:",r.props.uri),d.remove(r.props.id)})),i()(U.map(function(e){var t=e.local,r=e.info,n={};return r.position&&(n.props={position:r.position}),Object(l.p)(t.props.id,n)})));return P.push(Promise.all(P).then(function(){return Object(l.o)()}).then(function(e){if(e)return v=!0,d.list().then(function(e){e.forEach(function(e){var t=p.info[e.props.uri];t&&(t.position=e.props.position)})})})),P.push(Promise.all(P).then(function(){var t=[];return v&&(p.timestamp=Date.now(),t.push(e.put(n,JSON.stringify(p)))),O.timestamp=p.timestamp,O.lastSync=Date.now(),e.config.set("meta",O),Promise.all(t)})),Promise.all(P.map(function(e){return e.then(u.m,function(e){return e||!0})})).then(function(e){return e.filter(Boolean)}).then(function(e){if(e.length)throw e})}).then(function(){e.syncState.set("idle")},function(t){e.syncState.set("error"),e.log("Failed syncing:",e.name),e.log(t)})}});function U(e){h.push(e)}function P(){return n.get("current")}function M(e){return m[e||P()]}function T(){n||(n=function(){function e(e,t){var r=Object(u.n)(e);r.unshift("sync"),Object(f.t)(r,t)}return function(){var t=Object(f.i)("sync");t&&t.services||e([],t={services:{}})}(),{get:function(e,t){var r=Object(u.n)(e);return r.unshift("sync"),Object(f.i)(r,t)},set:e}}(),h.forEach(function(e){var t=new e,r=t.name;p.push(r),m[r]=t}));var e=M();e&&e.checkSync()}function _(){var e=M();return e&&Promise.resolve(function(e){if(!e.syncState.is(["ready","syncing"]))return e.authState.is(["idle","error"])?e.checkSync():e.authState.is("authorized")?e.startSync():void 0}(e)).then(v)}function $(){var e=M();e&&e.authorize()}function D(){var e=M();e&&e.revoke()}Object(f.k)(function(e){Object(s.a)(e,"sync.current")&&T()});var R="f0q12zup2uys5w8",I="https://violentmonkey.github.io/auth_dropbox.html";function C(e){return{size:e.size,uri:O(e.name)}}U(E.extend({name:"dropbox",displayName:"Dropbox",user(){return this.loadData({method:"POST",url:"https://api.dropboxapi.com/2/users/get_current_account"}).catch(function(e){return 401===e.status?Promise.reject({type:"unauthorized"}):Promise.reject({type:"error",data:e})})},handleMetaError(e){if(409===e.status)return{};throw e},list(){return this.loadData({method:"POST",url:"https://api.dropboxapi.com/2/files/list_folder",body:{path:""},responseType:"json"}).then(function(e){return e.entries.filter(function(e){return"file"===e[".tag"]&&j(e.name)}).map(C)})},get(e){var t=g(e);return this.loadData({method:"POST",url:"https://content.dropboxapi.com/2/files/download",headers:{"Dropbox-API-Arg":JSON.stringify({path:`/${t}`})}})},put(e,t){var r=g(e);return this.loadData({method:"POST",url:"https://content.dropboxapi.com/2/files/upload",headers:{"Dropbox-API-Arg":JSON.stringify({path:`/${r}`,mode:"overwrite"}),"Content-Type":"application/octet-stream"},body:t,responseType:"json"}).then(C)},remove(e){var t=g(e);return this.loadData({method:"POST",url:"https://api.dropboxapi.com/2/files/delete",body:{path:`/${t}`},responseType:"json"}).then(C)},authorize(){var e={response_type:"token",client_id:R,redirect_uri:I},t=`https://www.dropbox.com/oauth2/authorize?${Object(f.e)(e)}`;browser.tabs.create({url:t})},authorized(e){var t=Object(f.n)(e);t.access_token&&this.config.set({uid:t.uid,token:t.access_token})},checkAuth(e){var t=`${I}#`;if(e.startsWith(t))return this.authorized(e.slice(t.length)),this.checkSync(),!0},revoke(){return this.config.set({uid:null,token:null}),this.prepare()}}));var z=JSON.parse(window.atob("eyJjbGllbnRfc2VjcmV0Ijoiajl4M09WRXRIdmhpSEtEV09HcXV5TWZaS2s5NjA0MEgifQ==")),A=Object.assign({client_id:"000000004418358A",redirect_uri:"https://violentmonkey.github.io/auth_onedrive.html"},z);function q(e){return{size:e.size,uri:O(e.name)}}U(E.extend({name:"onedrive",displayName:"OneDrive",urlPrefix:"https://api.onedrive.com/v1.0",refreshToken(){var e=this,t=this.config.get("refresh_token");return this.authorized({refresh_token:t,grant_type:"refresh_token"}).then(function(){return e.prepare()})},user(){var e=this,t=function(){return e.loadData({url:"/drive",responseType:"json"})};return t().catch(function(r){if(401===r.status)return e.refreshToken().then(t);throw r}).catch(function(e){return 400===e.status&&"invalid_grant"===Object(s.a)(e,"data.error")?Promise.reject({type:"unauthorized"}):Promise.reject({type:"error",data:e})})},handleMetaError(e){var t=this;if(404===e.status){var r=e.xhr.getResponseHeader("WWW-Authenticate")||"";return/^Bearer realm="OneDriveAPI"/.test(r)?this.refreshToken().then(function(){return t.getMeta()}):{}}throw e},list(){return this.loadData({url:"/drive/special/approot/children",responseType:"json"}).then(function(e){return e.value.filter(function(e){return e.file&&j(e.name)}).map(q)})},get(e){var t=this,r=g(e);return this.loadData({url:`/drive/special/approot:/${encodeURIComponent(r)}`,responseType:"json"}).then(function(e){return t.loadData({url:e["@content.downloadUrl"],delay:!1})})},put(e,t){var r=g(e);return this.loadData({method:"PUT",url:`/drive/special/approot:/${encodeURIComponent(r)}:/content`,headers:{"Content-Type":"application/octet-stream"},body:t,responseType:"json"}).then(q)},remove(e){var t=g(e);return this.loadData({method:"DELETE",url:`/drive/special/approot:/${encodeURIComponent(t)}`}).catch(u.m)},authorize(){var e={client_id:A.client_id,scope:"onedrive.appfolder wl.offline_access",response_type:"code",redirect_uri:A.redirect_uri},t=`https://login.live.com/oauth20_authorize.srf?${Object(f.e)(e)}`;browser.tabs.create({url:t})},checkAuth(e){var t=this,r=`${A.redirect_uri}?code=`;if(e.startsWith(r))return this.authState.set("authorizing"),this.authorized({code:e.slice(r.length)}).then(function(){return t.checkSync()}),!0},revoke(){return this.config.set({uid:null,token:null,refresh_token:null}),this.prepare()},authorized(e){var t=this;return this.loadData({method:"POST",url:"https://login.live.com/oauth20_token.srf",prefix:"",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Object(f.e)(Object.assign({},{client_id:A.client_id,client_secret:A.client_secret,redirect_uri:A.redirect_uri,grant_type:"authorization_code"},e)),responseType:"json"}).then(function(e){if(!e.access_token)throw e;t.config.set({uid:e.user_id,token:e.access_token,refresh_token:e.refresh_token})})}}));var L=JSON.parse(window.atob("eyJjbGllbnRfc2VjcmV0IjoiTjBEbTZJOEV3bkJaeE1xMUpuMHN3UER0In0=")),N=Object.assign({client_id:"590447512361-05hjbhnf8ua3iha55e5pgqg15om0cpef.apps.googleusercontent.com",redirect_uri:"https://violentmonkey.github.io/auth_googledrive.html",scope:"https://www.googleapis.com/auth/drive.appdata"},L),B={status:"UNAUTHORIZED"};function V(e){return{id:e.id,size:+e.size,uri:O(e.name)}}U(E.extend({name:"googledrive",displayName:"Google Drive",urlPrefix:"https://www.googleapis.com/drive/v3",refreshToken(){var e=this,t=this.config.get("refresh_token");return t?this.authorized({refresh_token:t,grant_type:"refresh_token"}).then(function(){return e.prepare()}):Promise.reject({type:"unauthorized"})},user(){var e=this,t=function(){return e.loadData({url:`https://www.googleapis.com/oauth2/v3/tokeninfo?${Object(f.e)({access_token:e.config.get("token")})}`,responseType:"json"})};return t().then(function(t){return"online"===t.access_type?e.loadData({method:"POST",url:`https://accounts.google.com/o/oauth2/revoke?token=${e.config.get("token")}`,prefix:"",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(){return Object(f.p)({title:"Sync Upgraded",body:"Please reauthorize access to your Google Drive to complete the upgradation."}),Promise.reject("Online access revoked.")}):t.scope!==N.scope?Promise.reject(B):void 0}).catch(function(r){return r===B||400===r.status&&"Invalid Value"===Object(s.a)(r,"data.error_description")?e.refreshToken().then(t):Promise.reject({type:"error",data:r})})},getSyncData(){var e=this;return this.loadData({url:`/files?${Object(f.e)({spaces:"appDataFolder",fields:"files(id,name,size)"})}`,responseType:"json"}).then(function(t){var r,n=t.files.filter(function(t){return!!j(t.name)||(r||t.name!==e.metaFile?e.remove(t):r=t,!1)}).map(V).filter(function(t){return!!t.size||(e.remove(t),!1)}),o=r?V(r):{},i=e.get(o).then(function(e){return JSON.parse(e)}).catch(function(t){return e.handleMetaError(t)}).then(function(t){return Object.assign({},o,{data:t,uri:null,name:e.metaFile})});return Promise.all([i,n,e.getLocalData()])})},authorize(){var e={response_type:"code",access_type:"offline",client_id:N.client_id,redirect_uri:N.redirect_uri,scope:N.scope};this.config.get("refresh_token")||(e.prompt="consent");var t=`https://accounts.google.com/o/oauth2/v2/auth?${Object(f.e)(e)}`;browser.tabs.create({url:t})},checkAuth(e){var t=this,r=`${N.redirect_uri}?code=`;if(e.startsWith(r))return this.authState.set("authorizing"),this.authorized({code:e.split("#")[0].slice(r.length)}).then(function(){return t.checkSync()}),!0},revoke(){return this.config.set({token:null,refresh_token:null}),this.prepare()},authorized(e){var t=this;return this.loadData({method:"POST",url:"https://www.googleapis.com/oauth2/v4/token",prefix:"",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Object(f.e)(Object.assign({},{client_id:N.client_id,client_secret:N.client_secret,redirect_uri:N.redirect_uri,grant_type:"authorization_code"},e)),responseType:"json"}).then(function(e){if(!e.access_token)throw e;var r={token:e.access_token};e.refresh_token&&(r.refresh_token=e.refresh_token),t.config.set(r)})},handleMetaError:()=>({}),list(){throw new Error("Not supported")},get(e){var t=e.id;return t?this.loadData({url:`/files/${t}?alt=media`}):Promise.reject()},put(e,t){var r=g(e),n=e.id,o=Object(u.h)("violentmonkey-is-great-"),i={"Content-Type":`multipart/related; boundary=${o}`},c=n?{name:r}:{name:r,parents:["appDataFolder"]},a=[`--${o}`,"Content-Type: application/json; charset=UTF-8","",JSON.stringify(c),`--${o}`,"Content-Type: text/plain","",t,`--${o}--`,""].join("\r\n"),s=n?`https://www.googleapis.com/upload/drive/v3/files/${n}?uploadType=multipart`:"https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart";return this.loadData({url:s,body:a,headers:i,method:n?"PATCH":"POST"})},remove(e){var t=e.id;return this.loadData({method:"DELETE",url:`/files/${t}`})}})),r.d(t,"c",function(){return T}),r.d(t,"e",function(){return _}),r.d(t,"b",function(){return w}),r.d(t,"a",function(){return $}),r.d(t,"d",function(){return D}),browser.tabs.onUpdated.addListener(function(e,t){t.url&&function(e){return p.some(function(t){var r=m[t];return r.checkAuth&&r.checkAuth(e)})}(t.url)&&browser.tabs.remove(e)})},22:function(e,t,r){"use strict";(function(e){r.d(t,"c",function(){return p}),r.d(t,"b",function(){return h}),r.d(t,"e",function(){return m}),r.d(t,"a",function(){return v}),r.d(t,"d",function(){return b});var n=r(0),o=r(1),i=r(29),c={isApplied:!0,autoUpdate:!0,lastUpdate:0,lastModified:0,showBadge:"unique",exportValues:!0,closeAfterInstall:!1,trackLocalFile:!1,autoReload:!1,features:null,blacklist:null,syncScriptStatus:!0,sync:null,customCSS:null,importSettings:!0,notifyUpdates:!1,version:null,filters:{sort:"exec"},editor:{lineWrapping:!1,indentUnit:2},scriptTemplate:"// ==UserScript==\n// @name New Script\n// @namespace Violentmonkey Scripts\n// @match {{url}}\n// @grant none\n// ==/UserScript==\n"},a={},u=Object(n.j)(),s=Object(n.c)(function(){u.fire(a),a={}},100),f={},l=!1,d=browser.storage.local.get("options").then(function(t){var r=t.options;if(r&&"object"==typeof r&&(f=r),e.env.DEBUG&&console.log("options:",f),!Object(o.a)(f,"version")){e.env.DEBUG&&console.log("Upgrade options...");try{localStorage.length&&Object.keys(c).forEach(function(t){var r=localStorage.getItem(t);if(r)try{r=JSON.parse(r)}catch(e){r=null}r&&(e.env.DEBUG&&console.log("Upgrade option:",t,r),m(t,r))})}catch(e){}m("version",1)}}).then(function(){l=!0});function p(e,t){var r=Object(n.n)(e),i=r[0],a=f[i];return null==a&&(a=c[i]),null==a&&(a=t),r.length>1?Object(o.a)(a,r.slice(1),t):a}function h(e){return Object(o.a)(c,e)}function m(t,r){if(l){var i=Object(n.n)(t),u=i.join("."),h=r,v=i[0];v in c&&(i.length>1&&(h=Object(o.d)(p(v),i.slice(1),r)),f[v]=h,browser.storage.local.set({options:f}),function(e,t){Object(o.d)(a,e,t),s()}(i,r),e.env.DEBUG&&console.log("Options updated:",u,r,f))}else d.then(function(){m(t,r)})}function v(){return Object.keys(c).reduce(function(e,t){return e[t]=p(t),e},{})}Object(i.b)(d);var b=u.hook}).call(this,r(15))},29:function(e,t,r){"use strict";r.d(t,"b",function(){return o}),r.d(t,"a",function(){return i});var n=[];function o(e){n.push(e)}function i(){return Promise.all(n.map(function(e){return"function"==typeof e?e():e})).then(function(){})}},3:function(e,t,r){"use strict";var n=r(18),o=r(81),i=r(82);function c(){var e={};return{on:function(t,r){var n=e[t];n||(n=[],e[t]=n);n.push(r)},off:function(t,r){var n=e[t];if(n){var o=n.indexOf(r);o>=0&&n.splice(o,1)}},fire:function(t,r){var n=e[t];n&&n.forEach(function(e){e(r,t)})}}}var a=r(11),u=r(22),s=r(9),f=r.n(s),l=r(0),d={},p={},h=["user-agent","referer","origin","host","cookie"];function m(){var e=Object(l.h)();return d[e]={id:e,xhr:new XMLHttpRequest},e}function v(e,t){var r=d[e.id];if(r&&!r.cb){r.cb=t;var n=r.xhr;try{n.open(e.method,e.url,!0,e.user||"",e.password||""),n.setRequestHeader("VM-Verify",e.id),e.headers&&Object.keys(e.headers).forEach(function(t){var r=t.toLowerCase();r.startsWith("vm-")||n.setRequestHeader(h.includes(r)?`VM-${t}`:t,e.headers[t])}),e.timeout&&(n.timeout=e.timeout),e.responseType&&(n.responseType="arraybuffer"),e.overrideMimeType&&n.overrideMimeType(e.overrideMimeType);var o=function(e){var t=Promise.resolve(),r=e.xhr;return function(n){var o={id:e.id,type:n.type,resType:r.responseType},i={finalUrl:r.responseURL,readyState:r.readyState,responseHeaders:r.getAllResponseHeaders(),status:r.status,statusText:r.statusText};o.data=i;try{i.responseText=r.responseText}catch(e){}"progress"===n.type&&["lengthComputable","loaded","total"].forEach(function(e){i[e]=n[e]}),"loadend"===n.type&&b(e),t=t.then(function(){if(r.response&&"arraybuffer"===r.responseType){var e=r.getResponseHeader("Content-Type")||"application/octet-stream",t=Object(l.a)(r.response);i.response=`data:${e};base64,${window.btoa(t)}`}else i.response=r.response}).then(function(){e.cb&&e.cb(o)})}}(r);["abort","error","load","loadend","progress","readystatechange","timeout"].forEach(function(e){n[`on${e}`]=o});var i=e.data,c=i?function e(t){var r=t.cls,n=t.value;if("formdata"===r){var o=new FormData;return n&&Object.keys(n).forEach(function(t){n[t].forEach(function(r){o.append(t,e(r))})}),o}if(["blob","file"].includes(r)){for(var i=t.type,c=t.name,a=t.lastModified,u=new Uint8Array(n.length),s=0;s<n.length;s+=1)u[s]=n.charCodeAt(s);var f=[u.buffer];return"file"===r?new File(f,c,{type:i,lastModified:a}):new Blob(f,{type:i})}if(n)return JSON.parse(n)}(i):null;n.send(c)}catch(e){console.warn(e)}}}function b(e){e.coreId&&delete p[e.coreId],delete d[e.id]}function g(e){var t=d[e];t&&(t.xhr.abort(),b(t))}function j(e){return(e.code?Promise.resolve(e.code):Object(l.o)(e.url).then(function(e){var t=e.data;return Object(a.c)(t)?t:Promise.reject(Object(l.i)("msgInvalidScript"))})).then(function(t){n.a.put(e.url,t,3e3);var r=Object(l.h)();n.a.put(`confirm-${r}`,{url:e.url,from:e.from});var o=browser.runtime.getURL("/confirm/index.html");browser.tabs.create({url:`${o}#${r}`})})}browser.webRequest.onBeforeSendHeaders.addListener(function(e){var t=[],r={};e.requestHeaders.forEach(function(e){e.name.startsWith("VM-")?r[e.name.slice(3)]=e.value:t.push(e)});var n=r.Verify;if(n){var o=d[n];o&&(delete r.Verify,p[e.requestId]=n,o.coreId=e.requestId,Object.keys(r).forEach(function(e){h.includes(e.toLowerCase())&&t.push({name:e,value:r[e]})}))}return{requestHeaders:t}},{urls:["<all_urls>"],types:["xmlhttprequest"]},["blocking","requestHeaders"]);var O=/\.user\.js([?#]|$)/,y=["^https://greasyfork.org/scripts/[^/]*/code/[^/]*?\\.user\\.js([?#]|$)","^https://openuserjs.org/install/[^/]*/[^/]*?\\.user\\.js([?#]|$)","^https://github.com/[^/]*/[^/]*/raw/[^/]*/[^/]*?\\.user\\.js([?#]|$)","^https://gist.github.com/.*?/[^/]*?.user.js([?#]|$)"].map(function(e){return new RegExp(e)}),w=["//(?:(?:gist.|)github.com|greasyfork.org|openuserjs.org)/"].map(function(e){return new RegExp(e)}),k={};function S(e){return e.split("&").reduce(function(e,t){var r=t.split("=");return e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]),e},{})}function x(e){return Object.keys(e).map(function(t){return`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`}).join("&")}browser.webRequest.onBeforeRequest.addListener(function(e){var t=e.url;if("GET"===e.method&&O.test(t)&&!k[t]&&(y.some(function(e){return e.test(t)})||!w.some(function(e){return e.test(t)})))return Promise.all([Object(l.o)(t).catch(function(){return{data:""}}),e.tabId<0?Promise.resolve():browser.tabs.get(e.tabId)]).then(function(e){var r=f()(e,2),n=r[0].data,o=r[1];Object(a.e)(n).name?j({code:n,url:t,from:o&&o.url}):(k[t]||(k[t]={timer:setTimeout(function(){delete k[t]},1e4)}),o&&o.id&&browser.tabs.update(o.id,{url:t}))}),{redirectUrl:"javascript:history.back()"}},{urls:["<all_urls>"],types:["main_frame"]},["blocking"]);var E=r(29),U=r(13);r.d(t,"b",function(){return n.a}),r.d(t,"s",function(){return o.a}),r.d(t,"c",function(){return i.a}),r.d(t,"h",function(){return c}),r.d(t,"q",function(){return a.e}),r.d(t,"o",function(){return a.d}),r.d(t,"i",function(){return u.c}),r.d(t,"g",function(){return u.b}),r.d(t,"t",function(){return u.e}),r.d(t,"f",function(){return u.a}),r.d(t,"k",function(){return u.d}),r.d(t,"j",function(){return m}),r.d(t,"l",function(){return v}),r.d(t,"a",function(){return g}),r.d(t,"d",function(){return j}),r.d(t,"n",function(){return S}),r.d(t,"e",function(){return x}),r.d(t,"m",function(){return E.a}),r.d(t,"p",function(){return U.a}),r.d(t,"r",function(){return U.b})},33:function(e,t,r){"use strict";(function(e){r.d(t,"c",function(){return l}),r.d(t,"b",function(){return b}),r.d(t,"a",function(){return g});var n=r(28),o=r(18),i=r(22);n.c(!0);var c=/(.*?):\/\/([^/]*)\/(.*)/,a=[];Object(i.d)(function(e){"blacklist"in e&&g(e.blacklist||"")});var u=/^https?$/i;function s(e,t){return t.some(function(t){var r=`re:${t}`,n=o.a.get(r);return n?o.a.hit(r,6e4):(n=h(t),o.a.put(r,n,6e4)),n.test(e)})}function f(e,t){return t.some(function(t){var r=`match:${t}`,n=o.a.get(r);return n?o.a.hit(r,6e4):(n=m(t),o.a.put(r,n,6e4)),n.test(e)})}function l(e,t){var r=t.custom,n=t.meta,o=d(r.origMatch&&n.match,r.match),i=d(r.origInclude&&n.include,r.include),c=d(r.origExclude&&n.exclude,r.exclude),a=d(r.origExcludeMatch&&n.excludeMatch,r.excludeMatch),u=!o.length&&!i.length;return u=(u=(u=(u=u||f(e,o))||s(e,i))&&!f(e,a))&&!s(e,c)}function d(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce(function(e,t){return t?e.concat(t):e},[])}function p(e){return`^${e.replace(/([.?+[\]{}()|^$])/g,"\\$1").replace(/\*/g,".*?")}$`}function h(e){if(e.length>1&&"/"===e[0]&&"/"===e[e.length-1])return new RegExp(e.slice(1,-1));var t=p(e),r=new RegExp(t),o=[function(e){return r.test(e)}];if(n.d()&&e.includes(".tld/")){var i=t.replace("\\.tld/","((?:\\.\\w+)+)/");o.push(function(e){var t=e.match(i);if(t){var r=t[1].slice(1);if(n.b(r)===r)return!0}return!1})}return{test:function(e){return o.some(function(t){return t(e)})}}}function m(e){var t;if("<all_urls>"===e)t=function(){return!0};else{var r=e.match(c);if(r){var n=function(e){var t=new RegExp(p(e));return function(r){if("*"===e)return 1;if(e===r)return 1;if(/^\*\.[^*]*$/.test(e)){if(e.slice(2)===r)return 1;if(t.test(r))return 1}return 0}}(r[2]),o=function(e){var t=e.indexOf("#"),r=e.indexOf("?"),n=p(e);r>t&&(r=-1),r<0&&t<0?n=`${n.slice(0,-1)}(?:[?#]|$)`:t<0&&(n=`${n.slice(0,-1)}(?:#|$)`);var o=new RegExp(n);return function(e){return o.test(e)}}(r[3]);t=function(e){var t=e.match(c);return!!r&&!!t&&function(e,t){return e===t?1:"*"===e&&u.test(t)?1:0}(r[1],t[1])&&n(t[2])&&o(t[3])}}else t=function(){return!1}}return{test:t}}function v(e,t){if(t.startsWith(e))return t.slice(e.length).trim()}function b(e){for(var t=0;t<a.length;t+=1){var r=a[t],n=r.test,o=r.reject;if(n(e))return o}}function g(t){var r=null==t?Object(i.c)("blacklist"):t;e.env.DEBUG&&console.info("Reset blacklist:",r),a=(Array.isArray(r)?r:(r||"").split("\n")).map(function(e){var t=e.trim();if(!t||t.startsWith("#"))return null;var r=v("@include ",t);if(r)return{test:h(r).test,reject:!1};var n=v("@match ",t);if(n)return{test:m(n).test,reject:!1};var o=v("@exclude ",t);return o?{test:h(o).test,reject:!0}:t.indexOf("/")<0?{test:m(`*://${t}/*`).test,reject:!0}:{test:m(t).test,reject:!0}}).filter(Boolean)}}).call(this,r(15))},35:function(e,t,r){"use strict";r.d(t,"d",function(){return s}),r.d(t,"c",function(){return f}),r.d(t,"b",function(){return l}),r.d(t,"a",function(){return d});var n,o,i=r(0),c=r(5),a={},u={};function s(e,t){p();var r=t.key,o=t.value;n||(n={});var i=n[e];i||(i={},n[e]=i),i[r]=o||null}function f(e,t){return Object(c.b)(e,t).then(m)}function l(e){var t=u[e];t&&(Object.keys(t).forEach(function(t){var r=a[t];r&&delete r[e]}),delete u[e])}function d(e,t){var r=u[e];r||(r={},u[e]=r),t.forEach(function(t){r[t]=1;var n=a[t];n||(n={},a[t]=n),n[e]=1})}function p(){o||(o=Promise.resolve().then(h))}function h(){var e=n;n=null;var t=Object.keys(e);Object(c.k)(t).then(function(r){return t.forEach(function(t){var n=r[t]||{};r[t]=n;var o=e[t]||{};Object.keys(o).forEach(function(e){var t=o[e];t?n[e]=t:delete n[e]})}),Object(c.c)(r)}).then(m).catch(function(e){console.error("Values error:",e)}).then(function(){o=null,n&&p()})}function m(e){if(e){var t=Object.keys(e).reduce(function(e,t){return Object.assign(e,a[t])},{});Object.keys(t).forEach(function(t){browser.tabs.sendMessage(+t,{cmd:"UpdatedValues",data:e}).catch(i.m)})}}browser.tabs.onRemoved.addListener(function(e){l(e)})},5:function(e,t,r){"use strict";(function(e){r.d(t,"o",function(){return y}),r.d(t,"f",function(){return w}),r.d(t,"i",function(){return k}),r.d(t,"g",function(){return S}),r.d(t,"h",function(){return x}),r.d(t,"k",function(){return E}),r.d(t,"c",function(){return U}),r.d(t,"b",function(){return P}),r.d(t,"j",function(){return M}),r.d(t,"d",function(){return T}),r.d(t,"a",function(){return _}),r.d(t,"n",function(){return $}),r.d(t,"l",function(){return D}),r.d(t,"p",function(){return I}),r.d(t,"e",function(){return C}),r.d(t,"m",function(){return q}),r.d(t,"q",function(){return N});var n=r(14),o=r.n(n),i=r(9),c=r.n(i),a=r(0),u=r(1),s=r(11),f=r(33),l=r(29),d=r(88),p=r(22),h=r(13),m=r(94);function v(e){var t={};return function(r){var n=t[r];if(!n){for(var o=arguments.length,i=new Array(o>1?o-1:0),c=1;c<o;c++)i[c-1]=arguments[c];n=e.call.apply(e,[this,r].concat(i)).catch(function(e){console.error(`Error fetching: ${r}`,e)}).then(function(){delete t[r]}),t[r]=n}return n}}var b={},g={base:{prefix:"",getKey(e){return`${this.prefix}${e}`},getOne(e){var t=this.getKey(e);return browser.storage.local.get(t).then(function(e){return e[t]})},getMulti(e,t){var r=this;return browser.storage.local.get(e.map(function(e){return r.getKey(e)})).then(function(n){var o={};return e.forEach(function(e){o[e]=n[r.getKey(e)]||t}),o})},set(e,t){return e?browser.storage.local.set({[this.getKey(e)]:t}):Promise.resolve()},remove(e){return e?browser.storage.local.remove(this.getKey(e)):Promise.resolve()},removeMulti(e){var t=this;return browser.storage.local.remove(e.map(function(e){return t.getKey(e)}))}}};function j(e){return+e||0}function O(){var e=[];b.scripts.forEach(function(t,r){var n=r+1;Object(u.a)(t,"props.position")!==n&&(Object(u.d)(t,"props.position",n),e.push(t)),void 0===t.custom.origInclude&&(t.custom=Object.assign({origInclude:!0,origExclude:!0,origMatch:!0,origExcludeMatch:!0},t.custom),e.includes(t)||e.push(t))}),b.storeInfo.position=b.scripts.length;var t=e.length;return t?g.script.dump(e).then(function(){return Object(p.e)("lastModified",Date.now()),t}):Promise.resolve()}function y(){return b.scripts.sort(function(e,t){var r=[e,t].map(function(e){return j(Object(u.a)(e,"props.position"))}),n=c()(r,2);return n[0]-n[1]}),O().then(function(e){return Object(h.b)({cmd:"ScriptsUpdated"}),e})}function w(e){var t;if(e.id)t=b.scriptMap[e.id];else{var r=e.uri||Object(s.b)({meta:e.meta,id:"@@should-have-name"});t=b.scripts.find(function(e){return r===Object(u.a)(e,"props.uri")})}return Promise.resolve(t)}function k(){return Promise.resolve(b.scripts).then(function(e){return e.filter(function(e){return!e.config.removed})})}function S(e){return Promise.all(e.map(function(e){return w({id:e})})).then(function(e){return e.filter(Boolean)})}function x(e){return g.code.getOne(e)}function E(e){return g.value.getMulti(e)}function U(t){return e.env.DEBUG&&console.info("Update value stores",t),g.value.dump(t).then(function(){return t})}function P(e,t){return(e.id?Promise.resolve(e.id):w(e).then(function(e){return Object(u.a)(e,"props.id")})).then(function(e){if(e)return U({[e]:t})})}function M(e){var t=Object(f.b)(e)?[]:b.scripts.filter(function(t){return!t.config.removed&&Object(f.c)(e,t)}),r={},n={};t.forEach(function(e){if(e.config.enabled){e.custom.pathMap||L(e);var t=e.custom.pathMap;e.meta.require.forEach(function(e){r[t[e]||e]=1}),Object.values(e.meta.resources).forEach(function(e){n[t[e]||e]=1})}});var o=t.filter(function(e){return e.config.enabled}),i={GM_getValue:1,GM_setValue:1,GM_listValues:1,GM_deleteValue:1},a=o.filter(function(e){var t=Object(u.a)(e,"meta.grant");return t&&t.some(function(e){return i[e]})});return Promise.all([g.require.getMulti(Object.keys(r)),g.cache.getMulti(Object.keys(n)),g.value.getMulti(a.map(function(e){return e.props.id}),{}),g.code.getMulti(o.map(function(e){return e.props.id}))]).then(function(e){var r=c()(e,4),n=r[0],o=r[1],i=r[2],a=r[3];return{scripts:t,require:n,cache:o,values:i,code:a}})}function T(){var e={},t=b.scripts;return t.forEach(function(t){var r=Object(u.a)(t,"meta.icon");if(Object(a.k)(r)){var n=(Object(u.a)(t,"custom.pathMap")||{})[r]||r;e[n]=1}}),g.cache.getMulti(Object.keys(e)).then(function(e){return{scripts:t,cache:e}})}function _(){var e=b.scripts.filter(function(e){return e.config.removed});if(e.length){b.scripts=b.scripts.filter(function(e){return!e.config.removed});var t=e.map(function(e){return e.props.id});g.script.removeMulti(t),g.code.removeMulti(t),g.value.removeMulti(t)}return Promise.resolve(e.length)}function $(e){var t=b.scripts.findIndex(function(t){return e===Object(u.a)(t,"props.id")});return t>=0&&(b.scripts.splice(t,1),g.script.remove(e),g.code.remove(e),g.value.remove(e)),Object(h.b)({cmd:"RemoveScript",data:e}),Promise.resolve()}function D(e,t){var r=b.scripts.findIndex(function(t){return e===Object(u.a)(t,"props.id")}),n=t>0?1:-1,i=r,c=r+t,a=Math.min(i,c),s=Math.max(i,c),f=b.scripts.slice(a,s+1);return n>0?f.push(f.shift()):f.unshift(f.pop()),b.scripts=o()(b.scripts.slice(0,a)).concat(o()(f),o()(b.scripts.slice(s+1))),O()}function R(e,t){var r=e.config||{};r.enabled=j(r.enabled),r.shouldUpdate=j(r.shouldUpdate);var n,o=e.props||{};if(o.id?n=b.scriptMap[o.id]:(b.storeInfo.id+=1,o.id=b.storeInfo.id),o.uri=Object(s.b)(e),o.uuid=o.uuid||function(e){return`${(e+280880802).toString(16).slice(-8)}-${Object(a.g)()}-${Object(a.g)()}-${Object(a.g)()}-${Object(a.g)()}${Object(a.g)()}${Object(a.g)()}`}(o.id),b.scripts.some(function(e){var t=e.props||{};return o.id!==t.id&&o.uri===t.uri}))throw Object(a.i)("msgNamespaceConflict");if(n){e.config=Object.assign({},n.config,r),e.props=Object.assign({},n.props,o);var i=b.scripts.indexOf(n);b.scripts[i]=e}else o.position?b.storeInfo.position<o.position&&(b.storeInfo.position=o.position):(b.storeInfo.position+=1,o.position=b.storeInfo.position),e.config=r,e.props=o,b.scripts.push(e);return Promise.all([g.script.dump(e),g.code.set(o.id,t)])}function I(e,t){var r=b.scriptMap[e];return r?(r.props=Object.assign({},r.props,t.props),r.config=Object.assign({},r.config,t.config),g.script.dump(r)):Promise.reject()}function C(e,t){var r=e.filter(function(e){var t=b.scriptMap[e];return t&&!t.config.removed});return Promise.all([Promise.all(r.map(function(e){return w({id:e})})),g.code.getMulti(r)]).then(function(r){var n=c()(r,2),o=n[0],i=n[1],a={};return a.items=o.map(function(e){return{script:e,code:i[e.props.id]}}),t?g.value.getMulti(e).then(function(e){return a.values=e,a}):a})}g.script=Object.assign({},g.base,{prefix:"scr:",dump:function(e){return function(t){var r=Array.isArray(t)?t:[t];return(r=r.filter(Boolean)).length?e.call(this,r):Promise.resolve()}}(function(e){var t=this,r={};return e.forEach(function(e){r[t.getKey(e.props.id)]=e,b.scriptMap[e.props.id]=e}),browser.storage.local.set(r).then(function(){return e})})}),g.code=Object.assign({},g.base,{prefix:"code:"}),g.value=Object.assign({},g.base,{prefix:"val:",dump(e){var t=this,r={};return Object.keys(e).forEach(function(n){var o=e[n];r[t.getKey(n)]=o}),browser.storage.local.set(r)}}),g.require=Object.assign({},g.base,{prefix:"req:",fetch:v(function(e){var t=this;return Object(a.o)(e).then(function(r){var n=r.data;return t.set(e,n)})})}),g.cache=Object.assign({},g.base,{prefix:"cac:",fetch:v(function(e,t){var r=this;return Object(a.o)(e,{responseType:"arraybuffer"}).then(function(n){var o=n.data,i=(n.xhr.getResponseHeader("content-type")||"").split(";")[0],c={contentType:i,buffer:o,blob:function(e){return new Blob([o],Object.assign({type:i},e))},string:function(){return Object(a.a)(o)},base64:function(){return window.btoa(c.string())}};return(t?Promise.resolve(t(c)):Promise.resolve()).then(function(){return r.set(e,`${i},${c.base64()}`)})})})}),Object(l.b)(browser.storage.local.get("version").then(function(e){var t=e.version,r=browser.runtime.getManifest(),n=r.version;return(t?Promise.resolve():Object(d.a)()).then(function(){if(n!==t)return browser.storage.local.set({version:n})})}).then(function(){return browser.storage.local.get()}).then(function(t){var r=[],n={id:0,position:0};return Object.keys(t).forEach(function(e){var o=t[e];e.startsWith("scr:")&&(r.push(o),n.id=Math.max(n.id,j(Object(u.a)(o,"props.id"))),n.position=Math.max(n.position,j(Object(u.a)(o,"props.position"))))}),Object.assign(b,{scripts:r,storeInfo:n,scriptMap:r.reduce(function(e,t){return e[t.props.id]=t,e},{})}),e.env.DEBUG&&console.log("store:",b),y()}));var z="UpdateScript",A="AddScript";function q(e){var t=e.id,r=e.code,n=e.message,o=e.isNew,i=e.config,c=e.custom,f=e.props,l=e.update,d=Object(s.e)(r);if(!d.name)return Promise.reject(Object(a.i)("msgInvalidScript"));var p={cmd:z,data:{update:{message:null==n?Object(a.i)("msgUpdated"):n||""}}};return w({id:t,meta:d}).then(function(t){var n;if(t){if(o)throw Object(a.i)("msgNamespaceConflict");n=Object.assign({},t)}else{var l=Object(s.d)();n=l.script,p.cmd=A,p.data.isNew=!0,p.data.update.message=Object(a.i)("msgInstalled")}n.config=Object.assign({},n.config,i,{removed:0}),n.custom=Object.assign({},n.custom,c),n.props=Object.assign({},n.props,{lastModified:Date.now(),lastUpdated:Date.now()},f),n.meta=d,d.homepageURL||n.custom.homepageURL||!Object(a.k)(e.from)||(n.custom.homepageURL=e.from),Object(a.k)(e.url)&&(n.custom.lastInstallURL=e.url);var h=+e.position;return h&&Object(u.d)(n,"props.position",h),L(n,e.url),R(n,r).then(function(){return n})}).then(function(t){return function(e,t){var r=e.meta,n=e.custom.pathMap;if(r.require.forEach(function(e){var r=n[e]||e,o=Object(u.a)(t,["require",r]);o?g.require.set(r,o):g.require.fetch(r)}),Object.values(r.resources).forEach(function(e){var r=n[e]||e,o=Object(u.a)(t,["resources",r]);o?g.cache.set(r,o):g.cache.fetch(r)}),Object(a.k)(r.icon)){var o=n[r.icon]||r.icon;g.cache.fetch(o,function(e){var t=e.blob;return new Promise(function(e,r){var n=t(),o=URL.createObjectURL(n),i=new Image,c=function(){return URL.revokeObjectURL(o)};i.onload=function(){c(),e()},i.onerror=function(){c(),r({type:"IMAGE_ERROR",url:o})},i.src=o})})}}(t,e),Object.assign(p.data.update,t,l),p.data.where={id:t.props.id},Object(h.b)(p),m.a.emit("scriptChanged",p.data),p})}function L(e,t){var r=e.meta,n=t||e.custom.lastInstallURL,i=n?o()(r.require).concat(o()(Object.values(r.resources)),[r.icon]).reduce(function(e,t){if(t){var r=Object(a.e)(t,n);r!==t&&(e[t]=r)}return e},{}):{};return e.custom.pathMap=i,i}function N(){var e={},t={},r={},n={},o=[[g.value,e],[g.cache,t],[g.require,r],[g.code,n]];return browser.storage.local.get().then(function(i){Object.keys(i).forEach(function(e){o.some(function(t){var r=c()(t,2),n=r[0],o=r[1],i=n.prefix;return!!e.startsWith(i)&&(o[e.slice(i.length)]=-1,!0)})});var u=function(e,t){e[t]<0?e[t]=1:e[t]||(e[t]=2)};b.scripts.forEach(function(o){var i=o.props.id;u(n,i),u(e,i),o.custom.pathMap||L(o);var c=o.custom.pathMap;o.meta.require.forEach(function(e){u(r,c[e]||e)}),Object.values(o.meta.resources).forEach(function(e){u(t,c[e]||e)});var s=o.meta.icon;if(Object(a.k)(s)){var f=c[s]||s;u(t,f)}}),o.forEach(function(e){var t=c()(e,2),r=t[0],n=t[1];Object.keys(n).forEach(function(e){var t=n[e];t<0?r.remove(e):2===t&&r.fetch&&r.fetch(e)})})})}}).call(this,r(15))},72:function(e,t,r){"use strict";r.d(t,"b",function(){return c}),r.d(t,"a",function(){return a});var n=r(0),o=r(24),i={};function c(e,t){var r=e.url,n=e.active,c=t.tab||{},a={url:r,active:n,windowId:c.windowId,index:c.index+1};return o.b&&o.a||(a.openerTabId=c.id),browser.tabs.create(a).then(function(e){var t=e.id;return i[t]=c.id,{id:t}})}function a(e,t){var r=e&&e.id||t.tab&&t.tab.id;r&&browser.tabs.remove(r)}browser.tabs.onRemoved.addListener(function(e){var t=i[e];t&&(browser.tabs.sendMessage(t,{cmd:"TabClosed",data:e}).catch(n.m),delete i[e])})},81:function(e,t,r){"use strict";(function(e){r.d(t,"a",function(){return i});var n,o=document.createElement("textarea");function i(t){n=t,o.focus(),!document.execCommand("copy",!1,null)&&e.env.DEBUG&&console.warn("Copy failed!")}document.body.appendChild(o),document.addEventListener("copy",function(e){e.preventDefault();var t=n,r=t.type,o=t.data;e.clipboardData.setData(r||"text/plain",o)},!1)}).call(this,r(15))},82:function(e,t,r){"use strict";(function(e){r.d(t,"a",function(){return s});var n=r(0),o=r(5),i=r(11),c=r(22),a=r(13),u={};function s(t){var r=t.props.id,s=u[r];if(!s){var f=!1;s=function(e){var t={checking:!0},r={cmd:"UpdateScript",data:{where:{id:e.props.id},update:t}},o=e.custom.downloadURL||e.meta.downloadURL||e.custom.lastInstallURL,c=e.custom.updateURL||e.meta.updateURL||o;return c?(t.message=Object(n.i)("msgCheckingForUpdate"),Object(a.b)(r),Object(n.o)(c,{headers:{Accept:"text/x-userscript-meta"}}).then(function(o){var c=o.data,u=Object(i.e)(c);return Object(i.a)(e.meta.version,u.version)<0?Promise.resolve():(t.checking=!1,t.message=Object(n.i)("msgNoUpdate"),Object(a.b)(r),Promise.reject())},function(){return t.checking=!1,t.message=Object(n.i)("msgErrorFetchingUpdateInfo"),Object(a.b)(r),Promise.reject()}).then(function(){return o?(t.message=Object(n.i)("msgUpdating"),Object(a.b)(r),Object(n.o)(o).then(function(e){return e.data},function(){return t.checking=!1,t.message=Object(n.i)("msgErrorFetchingScript"),Object(a.b)(r),Promise.reject()})):(t.message=Object(n.i)("msgNewVersion"),Object(a.b)(r),Promise.reject())})):Promise.reject()}(t).then(function(e){return Object(o.m)({id:r,code:e,update:{checking:!1}})}).then(function(e){var t=e.data.update;f=!0,Object(c.c)("notifyUpdates")&&Object(a.a)({title:Object(n.i)("titleScriptUpdated"),body:Object(n.i)("msgScriptUpdated",[t.meta.name||Object(n.i)("labelNoName")])})}).catch(function(t){e.env.DEBUG&&console.error(t)}).then(function(){return delete u[r],f}),u[r]=s}return s}}).call(this,r(15))},87:function(e,t,r){var n=r(140);e.exports=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),o.forEach(function(t){n(e,t,r[t])})}return e}},88:function(e,t,r){"use strict";var n=r(11);t.a=function(){return new Promise(function(e,t){console.info("Upgrade database..."),function(){var r=indexedDB.open("Violentmonkey",1);r.onsuccess=function(){try{!function(r){var o=r.transaction(["scripts","require","cache","values"]),i={},c=3,a=function(){(c-=1)||e(browser.storage.local.set(i))};(function(e,r){var o=[],i=e.objectStore("scripts").openCursor();i.onsuccess=function(e){var t=e.target.result;if(t){var i=t.value;o.push(function(e){return{script:{meta:Object(n.e)(e.code),custom:Object.assign({origInclude:!0,origExclude:!0,origMatch:!0,origExcludeMatch:!0},e.custom),props:{id:e.id,uri:e.uri,position:e.position},config:{enabled:e.enabled,shouldUpdate:e.update}},code:e.code}}(i)),t.continue()}else r(o)},i.onerror=t})(o,function(e){var r={};e.forEach(function(e){var t=e.script,n=e.code;i[`scr:${t.props.id}`]=t,i[`code:${t.props.id}`]=n,r[t.props.uri]=t.props.id}),function(e,r,n){var o=[],i=e.objectStore("values").openCursor();i.onsuccess=function(e){var t=e.target.result;if(t){var i=t.value,c=i.uri,a=i.values,u=n[c];u&&o.push({id:u,values:a}),t.continue()}else r(o)},i.onerror=t}(o,function(e){e.forEach(function(e){var t=e.id,r=e.values;i[`val:${t}`]=r}),a()},r)}),function(e,r){var n=[],o=e.objectStore("cache").openCursor();o.onsuccess=function(e){var t=e.target.result;if(t){var o=t.value,i=o.uri,c=o.data;n.push({uri:i,data:c}),t.continue()}else r(n)},o.onerror=t}(o,function(e){e.forEach(function(e){var t=e.uri,r=e.data;i[`cac:${t}`]=r}),a()}),function(e,r){var n=[],o=e.objectStore("require").openCursor();o.onsuccess=function(e){var t=e.target.result;if(t){var o=t.value,i=o.uri,c=o.code;n.push({uri:i,code:c}),t.continue()}else r(n)},o.onerror=t}(o,function(e){e.forEach(function(e){var t=e.uri,r=e.code;i[`req:${t}`]=r}),a()})}(r.result)}catch(e){t(e)}},r.onerror=t,r.onupgradeneeded=function(){t()}}()}).catch(function(){})}},89:function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},90:function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}},91:function(e,t,r){"use strict";r.d(t,"a",function(){return i});var n=r(0),o={};function i(e,t){var r=t.tab||{};return browser.notifications.create({type:"basic",title:e.title||Object(n.i)("extName"),message:e.text,iconUrl:e.image||n.d}).then(function(e){return o[e]=r.id,e})}browser.notifications.onClicked.addListener(function(e){var t=o[e];t&&browser.tabs.sendMessage(t,{cmd:"NotificationClick",data:e}).catch(n.m)}),browser.notifications.onClosed.addListener(function(e){var t=o[e];t&&(browser.tabs.sendMessage(t,{cmd:"NotificationClose",data:e}).catch(n.m),delete o[e])})},94:function(e,t,r){"use strict";var n=r(89),o=r.n(n),i=r(90),c=r.n(i),a=function(){function e(t){o()(this,e),this.events={},this.allowed=t}return c()(e,[{key:"checkType",value:function(e){if(this.allowed&&!this.allowed.includes(e))throw new Error(`Unknown event type: ${e}`)}},{key:"on",value:function(e,t){var r=this;this.checkType(e);var n=this.events,o=n[e];return o||(o=[],n[e]=o),function(){return r.off(e,t)}}},{key:"off",value:function(e,t){this.checkType(e);var r=this.events[e];if(r){var n=r.indexOf(t);n>=0&&r.splice(n,1)}}},{key:"emit",value:function(e,t){this.checkType(e);var r=this.events[e];if(r){var n={type:e,data:t,defaultPrevented:!1,preventDefault(){n.defaultPrevented=!0}};r.some(function(e){return e(n),n.defaultPrevented})}}}]),e}();t.a=new a(["scriptEdit","scriptChanged"])}});